%
9010 (BROACHING MACRO)

(X - CENTER POSITION OF BROACH)
(Y - CENTER POSITION OF BROACH)
(Z - FINAL Z OF BROACH)
(R - START Z OF BROACH)
(S - SIDES)
(A - STARTING ANGLE)
(I - INSCRIBED CIRCLE OF BROACH)
(Q - INCREMENT RADIALLY)
(D - STARTING DIAMETER)
(F - FEEDRATE)
(W - WIDTH OF BROACH)
(C* - COMPLETE CIRCLE)
(J* - INCREMENT AXIALLY)
(E* - ANGLE BETWEEN IF NOT COMPLETE)
(U* - INTIAL CUT RADIAL DEPTH)

(****MATH****)
(CALCULATE FIRST CUT OF BROACH LOCATION)
#100=#7/2 (RAD OF STARTING CIRCLE)
#101=#100-.5*SQRT[[#23*#23]+4*[#100*#100]] (HEIGHT OF CIRCLE SEGMENT)
(CALCULATE NUMBER OF STEPS)
#102=ROUND[[#100-#101]/#17] (EVEN OUT THE STEPS)
(INITIAL TRIANGLE MATH)
(****MATH****)

WHILE[]DO1 (WHOLE BROACH CYCLE)

(POSITION FOR INITIAL BROACH)
M19 S# (INDEX)
G0 X Y (POSITION)
G0 Z (POSITION)

WHILE[#2]DO2 SINGLE BROACH 

G0 X Y (POSITION)
G0 Z (POSITION)
G1 Z F (BROACH)
G0 X Y (BACK OFF)
G0 Z (RETRACT)
(EXTEND HYPOTENUSE)
(INCREMENT)

END2

(ROTATION MATH)
(INCREMENT)

END1


M99
%
